##
# (c) 2023 - Cloud Ops Works LLC - https://cloudops.works/
#            On GitHub: https://github.com/cloudopsworks
#            Distributed Under Apache v2.0 License
#
# CI/CD configurations

# Repo & CD Configurations
# Some of them previously managed in OWNERS file
# now are managed from here
config:
  # Configure repository to enable branch protection
  # https://docs.github.com/en/rest/reference/repos#update-branch-protection
  branchProtection: true
  # Configure the repository to use Git Flow and or support Branches enablement
  gitFlow:
    enabled: true
    supportBranches: false
  # Protected sources rules (future implementation)
  protectedSources:
    - "*.tf"
    - "*.tfvars"
    - OWNERS
    - Makefile
    - .github

  # Optional only needed if not automatic or protection is true
  requiredReviewers: {{ .required_reviewers }}

  reviewers:
    {{- range $item := .reviewers }}
    - {{ $item }}
    {{- end }}

  # Optional Only needed for permit owners to perform commits under protected branches.
  # Teams are specified as org/team-name
  owners:
    {{- range $item := .owners }}
    - {{ $item }}
    {{- end }}

  # Optional configure the repository members
  contributors:
    {{- if .admin_contributors }}
    admin:
    {{- range $item := .admin_contributors }}
      - {{ $item }}
    {{- end }}
    {{- else }}
    admin: []
    {{- end }}
    {{- if .triage_contributors }}
    triage:
    {{- range $item := .triage_contributors }}
      - {{ $item }}
    {{- end }}
    {{- else }}
    triage: []
    {{- end }}
    {{- if .pull_contributors }}
    pull:
    {{- range $item := .pull_contributors }}
      - {{ $item }}
    {{- end }}
    {{- else }}
    pull: []
    {{- end }}
    {{- if .push_contributors }}
    push:
    {{- range $item := .push_contributors }}
      - {{ $item }}
    {{- end }}
    {{- else }}
    push: []
    {{- end }}
    {{- if .maintain_contributors }}
    maintain:
    {{- range $item := .maintain_contributors }}
      - {{ $item }}
    {{- end }}
    {{- else }}
    maintain: []
    {{- end }}

cd:
  # Indicate that the environment makes automatic merges and deploys
  automatic: false

  deployments:
    develop:
      env: dev
    release:
      env: production
    test:
      env: test
    prerelease:
      env: uat